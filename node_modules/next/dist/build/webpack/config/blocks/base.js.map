{"version":3,"sources":["../../../../../src/build/webpack/config/blocks/base.ts"],"sourcesContent":["import curry from 'next/dist/compiled/lodash.curry'\nimport type { webpack } from 'next/dist/compiled/webpack/webpack'\nimport { COMPILER_NAMES } from '../../../../shared/lib/constants'\nimport type { ConfigurationContext } from '../utils'\nimport DevToolsIgnorePlugin from '../../plugins/devtools-ignore-list-plugin'\nimport EvalSourceMapDevToolPlugin from '../../plugins/eval-source-map-dev-tool-plugin'\n\nfunction shouldIgnorePath(modulePath: string): boolean {\n  // TODO: How to ignore list 'webpack:///../../../src/shared/lib/is-thenable.ts'\n  return (\n    modulePath.includes('node_modules') ||\n    // would filter 'webpack://_N_E/./app/page.tsx'\n    // modulePath.startsWith('webpack://_N_E/') ||\n    // e.g. 'webpack:///external commonjs \"next/dist/compiled/next-server/app-page.runtime.dev.js\"'\n    modulePath.includes('next/dist')\n  )\n}\n\nexport const base = curry(function base(\n  ctx: ConfigurationContext,\n  config: webpack.Configuration\n) {\n  config.mode = ctx.isDevelopment ? 'development' : 'production'\n  config.name = ctx.isServer\n    ? ctx.isEdgeRuntime\n      ? COMPILER_NAMES.edgeServer\n      : COMPILER_NAMES.server\n    : COMPILER_NAMES.client\n\n  config.target = !ctx.targetWeb\n    ? 'node18.17' // Same version defined in packages/next/package.json#engines\n    : ctx.isEdgeRuntime\n      ? ['web', 'es6']\n      : ['web', 'es6']\n\n  // https://webpack.js.org/configuration/devtool/#development\n  if (ctx.isDevelopment) {\n    if (process.env.__NEXT_TEST_MODE && !process.env.__NEXT_TEST_WITH_DEVTOOL) {\n      config.devtool = false\n    } else {\n      // `eval-source-map` provides full-fidelity source maps for the\n      // original source, including columns and original variable names.\n      // This is desirable so the in-browser debugger can correctly pause\n      // and show scoped variables with their original names.\n      // We're using a fork of `eval-source-map`\n      config.devtool = false\n      config.plugins ??= []\n      config.plugins.push(\n        new EvalSourceMapDevToolPlugin({\n          shouldIgnorePath,\n        })\n      )\n    }\n  } else {\n    if (\n      ctx.isEdgeRuntime ||\n      (ctx.isServer && ctx.serverSourceMaps) ||\n      // Enable browser sourcemaps:\n      (ctx.productionBrowserSourceMaps && ctx.isClient)\n    ) {\n      config.devtool = 'source-map'\n      config.plugins ??= []\n      config.plugins.push(\n        new DevToolsIgnorePlugin({\n          // TODO: eval-source-map has different module paths than source-map.\n          // We're currently not actually ignore listing anything.\n          shouldIgnorePath,\n        })\n      )\n    } else {\n      config.devtool = false\n    }\n  }\n\n  if (!config.module) {\n    config.module = { rules: [] }\n  }\n\n  // TODO: add codemod for \"Should not import the named export\" with JSON files\n  // config.module.strictExportPresence = !isWebpack5\n\n  return config\n})\n"],"names":["base","shouldIgnorePath","modulePath","includes","curry","ctx","config","mode","isDevelopment","name","isServer","isEdgeRuntime","COMPILER_NAMES","edgeServer","server","client","target","targetWeb","process","env","__NEXT_TEST_MODE","__NEXT_TEST_WITH_DEVTOOL","devtool","plugins","push","EvalSourceMapDevToolPlugin","serverSourceMaps","productionBrowserSourceMaps","isClient","DevToolsIgnorePlugin","module","rules"],"mappings":";;;;+BAkBaA;;;eAAAA;;;oEAlBK;2BAEa;iFAEE;mFACM;;;;;;AAEvC,SAASC,iBAAiBC,UAAkB;IAC1C,+EAA+E;IAC/E,OACEA,WAAWC,QAAQ,CAAC,mBACpB,+CAA+C;IAC/C,8CAA8C;IAC9C,+FAA+F;IAC/FD,WAAWC,QAAQ,CAAC;AAExB;AAEO,MAAMH,OAAOI,IAAAA,oBAAK,EAAC,SAASJ,KACjCK,GAAyB,EACzBC,MAA6B;IAE7BA,OAAOC,IAAI,GAAGF,IAAIG,aAAa,GAAG,gBAAgB;IAClDF,OAAOG,IAAI,GAAGJ,IAAIK,QAAQ,GACtBL,IAAIM,aAAa,GACfC,yBAAc,CAACC,UAAU,GACzBD,yBAAc,CAACE,MAAM,GACvBF,yBAAc,CAACG,MAAM;IAEzBT,OAAOU,MAAM,GAAG,CAACX,IAAIY,SAAS,GAC1B,YAAY,6DAA6D;OACzEZ,IAAIM,aAAa,GACf;QAAC;QAAO;KAAM,GACd;QAAC;QAAO;KAAM;IAEpB,4DAA4D;IAC5D,IAAIN,IAAIG,aAAa,EAAE;QACrB,IAAIU,QAAQC,GAAG,CAACC,gBAAgB,IAAI,CAACF,QAAQC,GAAG,CAACE,wBAAwB,EAAE;YACzEf,OAAOgB,OAAO,GAAG;QACnB,OAAO;YACL,+DAA+D;YAC/D,kEAAkE;YAClE,mEAAmE;YACnE,uDAAuD;YACvD,0CAA0C;YAC1ChB,OAAOgB,OAAO,GAAG;YACjBhB,OAAOiB,OAAO,KAAK,EAAE;YACrBjB,OAAOiB,OAAO,CAACC,IAAI,CACjB,IAAIC,mCAA0B,CAAC;gBAC7BxB;YACF;QAEJ;IACF,OAAO;QACL,IACEI,IAAIM,aAAa,IAChBN,IAAIK,QAAQ,IAAIL,IAAIqB,gBAAgB,IACrC,6BAA6B;QAC5BrB,IAAIsB,2BAA2B,IAAItB,IAAIuB,QAAQ,EAChD;YACAtB,OAAOgB,OAAO,GAAG;YACjBhB,OAAOiB,OAAO,KAAK,EAAE;YACrBjB,OAAOiB,OAAO,CAACC,IAAI,CACjB,IAAIK,iCAAoB,CAAC;gBACvB,oEAAoE;gBACpE,wDAAwD;gBACxD5B;YACF;QAEJ,OAAO;YACLK,OAAOgB,OAAO,GAAG;QACnB;IACF;IAEA,IAAI,CAAChB,OAAOwB,MAAM,EAAE;QAClBxB,OAAOwB,MAAM,GAAG;YAAEC,OAAO,EAAE;QAAC;IAC9B;IAEA,6EAA6E;IAC7E,mDAAmD;IAEnD,OAAOzB;AACT"}