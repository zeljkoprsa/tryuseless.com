{"version":3,"sources":["../../../../../../src/client/components/react-dev-overlay/internal/helpers/stitched-error.ts"],"sourcesContent":["import React from 'react'\nimport isError from '../../../../../lib/is-error'\n\nconst REACT_ERROR_STACK_BOTTOM_FRAME = 'react-stack-bottom-frame'\nconst REACT_ERROR_STACK_BOTTOM_FRAME_REGEX = new RegExp(\n  `(at ${REACT_ERROR_STACK_BOTTOM_FRAME} )|(${REACT_ERROR_STACK_BOTTOM_FRAME}\\\\@)`\n)\n\nexport function getReactStitchedError<T = unknown>(err: T): Error | T {\n  if (typeof (React as any).captureOwnerStack !== 'function') {\n    return err\n  }\n  const isErrorInstance = isError(err)\n  const originStack = isErrorInstance ? err.stack || '' : ''\n  const originMessage = isErrorInstance ? err.message : ''\n  const stackLines = originStack.split('\\n')\n  const indexOfSplit = stackLines.findIndex((line) =>\n    REACT_ERROR_STACK_BOTTOM_FRAME_REGEX.test(line)\n  )\n  const isOriginalReactError = indexOfSplit >= 0 // has the react-stack-bottom-frame\n  let newStack = isOriginalReactError\n    ? stackLines.slice(0, indexOfSplit).join('\\n')\n    : originStack\n\n  const newError = new Error(originMessage)\n  // Copy all enumerable properties, e.g. digest\n  Object.assign(newError, err)\n  newError.stack = newStack\n\n  // Avoid duplicate overriding stack frames\n  const ownerStack = (React as any).captureOwnerStack()\n  if (ownerStack && newStack.endsWith(ownerStack) === false) {\n    newStack += ownerStack\n    // Override stack\n    newError.stack = newStack\n  }\n\n  return newError\n}\n"],"names":["React","isError","REACT_ERROR_STACK_BOTTOM_FRAME","REACT_ERROR_STACK_BOTTOM_FRAME_REGEX","RegExp","getReactStitchedError","err","captureOwnerStack","isErrorInstance","originStack","stack","originMessage","message","stackLines","split","indexOfSplit","findIndex","line","test","isOriginalReactError","newStack","slice","join","newError","Error","Object","assign","ownerStack","endsWith"],"mappings":"AAAA,OAAOA,WAAW,QAAO;AACzB,OAAOC,aAAa,8BAA6B;AAEjD,MAAMC,iCAAiC;AACvC,MAAMC,uCAAuC,IAAIC,OAC/C,AAAC,SAAMF,iCAA+B,SAAMA,iCAA+B;AAG7E,OAAO,SAASG,sBAAmCC,GAAM;IACvD,IAAI,OAAO,AAACN,MAAcO,iBAAiB,KAAK,YAAY;QAC1D,OAAOD;IACT;IACA,MAAME,kBAAkBP,QAAQK;IAChC,MAAMG,cAAcD,kBAAkBF,IAAII,KAAK,IAAI,KAAK;IACxD,MAAMC,gBAAgBH,kBAAkBF,IAAIM,OAAO,GAAG;IACtD,MAAMC,aAAaJ,YAAYK,KAAK,CAAC;IACrC,MAAMC,eAAeF,WAAWG,SAAS,CAAC,CAACC,OACzCd,qCAAqCe,IAAI,CAACD;IAE5C,MAAME,uBAAuBJ,gBAAgB,EAAE,mCAAmC;;IAClF,IAAIK,WAAWD,uBACXN,WAAWQ,KAAK,CAAC,GAAGN,cAAcO,IAAI,CAAC,QACvCb;IAEJ,MAAMc,WAAW,IAAIC,MAAMb;IAC3B,8CAA8C;IAC9Cc,OAAOC,MAAM,CAACH,UAAUjB;IACxBiB,SAASb,KAAK,GAAGU;IAEjB,0CAA0C;IAC1C,MAAMO,aAAa,AAAC3B,MAAcO,iBAAiB;IACnD,IAAIoB,cAAcP,SAASQ,QAAQ,CAACD,gBAAgB,OAAO;QACzDP,YAAYO;QACZ,iBAAiB;QACjBJ,SAASb,KAAK,GAAGU;IACnB;IAEA,OAAOG;AACT"}