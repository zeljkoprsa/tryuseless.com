{"version":3,"sources":["../../../../src/server/lib/router-utils/setup-dev-bundler.ts"],"sourcesContent":["import type { NextConfigComplete } from '../../config-shared'\nimport type { FilesystemDynamicRoute } from './filesystem'\nimport type { UnwrapPromise } from '../../../lib/coalesced-function'\nimport {\n  getPageStaticInfo,\n  type MiddlewareMatcher,\n} from '../../../build/analysis/get-page-static-info'\nimport type { MiddlewareRouteMatch } from '../../../shared/lib/router/utils/middleware-route-matcher'\nimport type { PropagateToWorkersField } from './types'\nimport type { NextJsHotReloaderInterface } from '../../dev/hot-reloader-types'\n\nimport { createDefineEnv } from '../../../build/swc'\nimport type { Project } from '../../../build/swc/types'\nimport fs from 'fs'\nimport { mkdir } from 'fs/promises'\nimport url from 'url'\nimport path from 'path'\nimport qs from 'querystring'\nimport Watchpack from 'next/dist/compiled/watchpack'\nimport { loadEnvConfig } from '@next/env'\nimport isError, { type NextError } from '../../../lib/is-error'\nimport findUp from 'next/dist/compiled/find-up'\nimport { buildCustomRoute } from './filesystem'\nimport * as Log from '../../../build/output/log'\nimport HotReloaderWebpack from '../../dev/hot-reloader-webpack'\nimport { setGlobal } from '../../../trace/shared'\nimport type { Telemetry } from '../../../telemetry/storage'\nimport type { IncomingMessage, ServerResponse } from 'http'\nimport loadJsConfig from '../../../build/load-jsconfig'\nimport { createValidFileMatcher } from '../find-page-file'\nimport { eventCliSession } from '../../../telemetry/events'\nimport { getDefineEnv } from '../../../build/webpack/plugins/define-env-plugin'\nimport { logAppDirError } from '../../dev/log-app-dir-error'\nimport { getSortedRoutes } from '../../../shared/lib/router/utils'\nimport {\n  getStaticInfoIncludingLayouts,\n  sortByPageExts,\n} from '../../../build/entries'\nimport { verifyTypeScriptSetup } from '../../../lib/verify-typescript-setup'\nimport { verifyPartytownSetup } from '../../../lib/verify-partytown-setup'\nimport { getRouteRegex } from '../../../shared/lib/router/utils/route-regex'\nimport { normalizeAppPath } from '../../../shared/lib/router/utils/app-paths'\nimport { buildDataRoute } from './build-data-route'\nimport { getRouteMatcher } from '../../../shared/lib/router/utils/route-matcher'\nimport { normalizePathSep } from '../../../shared/lib/page-path/normalize-path-sep'\nimport { createClientRouterFilter } from '../../../lib/create-client-router-filter'\nimport { absolutePathToPage } from '../../../shared/lib/page-path/absolute-path-to-page'\nimport { generateInterceptionRoutesRewrites } from '../../../lib/generate-interception-routes-rewrites'\n\nimport {\n  CLIENT_STATIC_FILES_PATH,\n  COMPILER_NAMES,\n  DEV_CLIENT_PAGES_MANIFEST,\n  DEV_CLIENT_MIDDLEWARE_MANIFEST,\n  PHASE_DEVELOPMENT_SERVER,\n} from '../../../shared/lib/constants'\n\nimport { getMiddlewareRouteMatcher } from '../../../shared/lib/router/utils/middleware-route-matcher'\n\nimport {\n  isMiddlewareFile,\n  NestedMiddlewareError,\n  isInstrumentationHookFile,\n  getPossibleMiddlewareFilenames,\n  getPossibleInstrumentationHookFilenames,\n} from '../../../build/utils'\nimport {\n  createOriginalStackFrame,\n  getSourceMapFromCompilation,\n  getSourceMapFromFile,\n  parseStack,\n} from '../../../client/components/react-dev-overlay/server/middleware'\nimport {\n  batchedTraceSource,\n  createOriginalStackFrame as createOriginalTurboStackFrame,\n} from '../../../client/components/react-dev-overlay/server/middleware-turbopack'\nimport type { OriginalStackFrameResponse } from '../../../client/components/react-dev-overlay/server/shared'\nimport { devPageFiles } from '../../../build/webpack/plugins/next-types-plugin/shared'\nimport type { LazyRenderServerInstance } from '../router-server'\nimport { HMR_ACTIONS_SENT_TO_BROWSER } from '../../dev/hot-reloader-types'\nimport { PAGE_TYPES } from '../../../lib/page-types'\nimport { createHotReloaderTurbopack } from '../../dev/hot-reloader-turbopack'\nimport { getErrorSource } from '../../../shared/lib/error-source'\nimport type { StackFrame } from 'next/dist/compiled/stacktrace-parser'\nimport { generateEncryptionKeyBase64 } from '../../app-render/encryption-utils-server'\nimport {\n  ModuleBuildError,\n  TurbopackInternalError,\n} from '../../dev/turbopack-utils'\nimport { isMetadataRouteFile } from '../../../lib/metadata/is-metadata-route'\nimport { normalizeMetadataPageToRoute } from '../../../lib/metadata/get-metadata-route'\nimport { createEnvDefinitions } from '../experimental/create-env-definitions'\nimport { JsConfigPathsPlugin } from '../../../build/webpack/plugins/jsconfig-paths-plugin'\nimport { store as consoleStore } from '../../../build/output/store'\n\nexport type SetupOpts = {\n  renderServer: LazyRenderServerInstance\n  dir: string\n  turbo?: boolean\n  appDir?: string\n  pagesDir?: string\n  telemetry: Telemetry\n  isCustomServer?: boolean\n  fsChecker: UnwrapPromise<\n    ReturnType<typeof import('./filesystem').setupFsCheck>\n  >\n  nextConfig: NextConfigComplete\n  port: number\n  onCleanup: (listener: () => Promise<void>) => void\n  resetFetch: () => void\n}\n\nexport type ServerFields = {\n  actualMiddlewareFile?: string | undefined\n  actualInstrumentationHookFile?: string | undefined\n  appPathRoutes?: Record<string, string | string[]>\n  middleware?:\n    | {\n        page: string\n        match: MiddlewareRouteMatch\n        matchers?: MiddlewareMatcher[]\n      }\n    | undefined\n  hasAppNotFound?: boolean\n  interceptionRoutes?: ReturnType<\n    typeof import('./filesystem').buildCustomRoute\n  >[]\n  setAppIsrStatus?: (key: string, value: boolean) => void\n  resetFetch?: () => void\n}\n\nasync function verifyTypeScript(opts: SetupOpts) {\n  let usingTypeScript = false\n  const verifyResult = await verifyTypeScriptSetup({\n    dir: opts.dir,\n    distDir: opts.nextConfig.distDir,\n    intentDirs: [opts.pagesDir, opts.appDir].filter(Boolean) as string[],\n    typeCheckPreflight: false,\n    tsconfigPath: opts.nextConfig.typescript.tsconfigPath,\n    disableStaticImages: opts.nextConfig.images.disableStaticImages,\n    hasAppDir: !!opts.appDir,\n    hasPagesDir: !!opts.pagesDir,\n  })\n\n  if (verifyResult.version) {\n    usingTypeScript = true\n  }\n  return usingTypeScript\n}\n\nexport async function propagateServerField(\n  opts: SetupOpts,\n  field: PropagateToWorkersField,\n  args: any\n) {\n  await opts.renderServer?.instance?.propagateServerField(opts.dir, field, args)\n}\n\nasync function startWatcher(opts: SetupOpts) {\n  const { nextConfig, appDir, pagesDir, dir, resetFetch } = opts\n  const { useFileSystemPublicRoutes } = nextConfig\n  const usingTypeScript = await verifyTypeScript(opts)\n\n  const distDir = path.join(opts.dir, opts.nextConfig.distDir)\n\n  // we ensure the types directory exists here\n  if (usingTypeScript) {\n    const distTypesDir = path.join(distDir, 'types')\n    if (!fs.existsSync(distTypesDir)) {\n      await mkdir(distTypesDir, { recursive: true })\n    }\n  }\n\n  setGlobal('distDir', distDir)\n  setGlobal('phase', PHASE_DEVELOPMENT_SERVER)\n\n  const validFileMatcher = createValidFileMatcher(\n    nextConfig.pageExtensions,\n    appDir\n  )\n\n  const serverFields: ServerFields = {}\n\n  // Update logging state once based on next.config.js when initializing\n  consoleStore.setState({\n    logging: nextConfig.logging !== false,\n  })\n\n  const hotReloader: NextJsHotReloaderInterface = opts.turbo\n    ? await createHotReloaderTurbopack(opts, serverFields, distDir, resetFetch)\n    : new HotReloaderWebpack(opts.dir, {\n        appDir,\n        pagesDir,\n        distDir,\n        config: opts.nextConfig,\n        buildId: 'development',\n        encryptionKey: await generateEncryptionKeyBase64({\n          isBuild: false,\n          distDir,\n        }),\n        telemetry: opts.telemetry,\n        rewrites: opts.fsChecker.rewrites,\n        previewProps: opts.fsChecker.prerenderManifest.preview,\n        resetFetch,\n      })\n\n  await hotReloader.start()\n\n  if (opts.nextConfig.experimental.nextScriptWorkers) {\n    await verifyPartytownSetup(\n      opts.dir,\n      path.join(distDir, CLIENT_STATIC_FILES_PATH)\n    )\n  }\n\n  opts.fsChecker.ensureCallback(async function ensure(item) {\n    if (item.type === 'appFile' || item.type === 'pageFile') {\n      await hotReloader.ensurePage({\n        clientOnly: false,\n        page: item.itemPath,\n        isApp: item.type === 'appFile',\n        definition: undefined,\n      })\n    }\n  })\n\n  let resolved = false\n  let prevSortedRoutes: string[] = []\n\n  await new Promise<void>(async (resolve, reject) => {\n    if (pagesDir) {\n      // Watchpack doesn't emit an event for an empty directory\n      fs.readdir(pagesDir, (_, files) => {\n        if (files?.length) {\n          return\n        }\n\n        if (!resolved) {\n          resolve()\n          resolved = true\n        }\n      })\n    }\n\n    const pages = pagesDir ? [pagesDir] : []\n    const app = appDir ? [appDir] : []\n    const directories = [...pages, ...app]\n\n    const rootDir = pagesDir || appDir\n    const files = [\n      ...getPossibleMiddlewareFilenames(\n        path.join(rootDir!, '..'),\n        nextConfig.pageExtensions\n      ),\n      ...getPossibleInstrumentationHookFilenames(\n        path.join(rootDir!, '..'),\n        nextConfig.pageExtensions\n      ),\n    ]\n    let nestedMiddleware: string[] = []\n\n    const envFiles = [\n      '.env.development.local',\n      '.env.local',\n      '.env.development',\n      '.env',\n    ].map((file) => path.join(dir, file))\n\n    files.push(...envFiles)\n\n    // tsconfig/jsconfig paths hot-reloading\n    const tsconfigPaths = [\n      path.join(dir, 'tsconfig.json'),\n      path.join(dir, 'jsconfig.json'),\n    ] as const\n    files.push(...tsconfigPaths)\n\n    const wp = new Watchpack({\n      ignored: (pathname: string) => {\n        return (\n          !files.some((file) => file.startsWith(pathname)) &&\n          !directories.some(\n            (d) => pathname.startsWith(d) || d.startsWith(pathname)\n          )\n        )\n      },\n    })\n    const fileWatchTimes = new Map()\n    let enabledTypeScript = usingTypeScript\n    let previousClientRouterFilters: any\n    let previousConflictingPagePaths: Set<string> = new Set()\n    let previouslyHadSegmentError = false\n\n    wp.on('aggregated', async () => {\n      let middlewareMatchers: MiddlewareMatcher[] | undefined\n      const routedPages: string[] = []\n      const knownFiles = wp.getTimeInfoEntries()\n      const appPaths: Record<string, string[]> = {}\n      const pageNameSet = new Set<string>()\n      const conflictingAppPagePaths = new Set<string>()\n      const appPageFilePaths = new Map<string, string>()\n      const pagesPageFilePaths = new Map<string, string>()\n      const pagesWithUnsupportedSegments = new Map<string, string[]>()\n\n      let envChange = false\n      let tsconfigChange = false\n      let conflictingPageChange = 0\n      let hasRootAppNotFound = false\n\n      const { appFiles, pageFiles } = opts.fsChecker\n\n      appFiles.clear()\n      pageFiles.clear()\n      devPageFiles.clear()\n      pagesWithUnsupportedSegments.clear()\n\n      const sortedKnownFiles: string[] = [...knownFiles.keys()].sort(\n        sortByPageExts(nextConfig.pageExtensions)\n      )\n\n      for (const fileName of sortedKnownFiles) {\n        if (\n          !files.includes(fileName) &&\n          !directories.some((d) => fileName.startsWith(d))\n        ) {\n          continue\n        }\n        const meta = knownFiles.get(fileName)\n\n        const watchTime = fileWatchTimes.get(fileName)\n        // If the file is showing up for the first time or the meta.timestamp is changed since last time\n        const watchTimeChange =\n          watchTime === undefined ||\n          (watchTime && watchTime !== meta?.timestamp)\n        fileWatchTimes.set(fileName, meta?.timestamp)\n\n        if (envFiles.includes(fileName)) {\n          if (watchTimeChange) {\n            envChange = true\n          }\n          continue\n        }\n\n        if (tsconfigPaths.includes(fileName)) {\n          if (fileName.endsWith('tsconfig.json')) {\n            enabledTypeScript = true\n          }\n          if (watchTimeChange) {\n            tsconfigChange = true\n          }\n          continue\n        }\n\n        if (\n          meta?.accuracy === undefined ||\n          !validFileMatcher.isPageFile(fileName)\n        ) {\n          continue\n        }\n\n        const isAppPath = Boolean(\n          appDir &&\n            normalizePathSep(fileName).startsWith(\n              normalizePathSep(appDir) + '/'\n            )\n        )\n        const isPagePath = Boolean(\n          pagesDir &&\n            normalizePathSep(fileName).startsWith(\n              normalizePathSep(pagesDir) + '/'\n            )\n        )\n\n        const rootFile = absolutePathToPage(fileName, {\n          dir: dir,\n          extensions: nextConfig.pageExtensions,\n          keepIndex: false,\n          pagesType: PAGE_TYPES.ROOT,\n        })\n\n        if (isMiddlewareFile(rootFile)) {\n          const staticInfo = await getStaticInfoIncludingLayouts({\n            pageFilePath: fileName,\n            config: nextConfig,\n            appDir: appDir,\n            page: rootFile,\n            isDev: true,\n            isInsideAppDir: isAppPath,\n            pageExtensions: nextConfig.pageExtensions,\n          })\n          if (nextConfig.output === 'export') {\n            Log.error(\n              'Middleware cannot be used with \"output: export\". See more info here: https://nextjs.org/docs/advanced-features/static-html-export'\n            )\n            continue\n          }\n          serverFields.actualMiddlewareFile = rootFile\n          await propagateServerField(\n            opts,\n            'actualMiddlewareFile',\n            serverFields.actualMiddlewareFile\n          )\n          middlewareMatchers = staticInfo.middleware?.matchers || [\n            { regexp: '.*', originalSource: '/:path*' },\n          ]\n          continue\n        }\n        if (isInstrumentationHookFile(rootFile)) {\n          serverFields.actualInstrumentationHookFile = rootFile\n          await propagateServerField(\n            opts,\n            'actualInstrumentationHookFile',\n            serverFields.actualInstrumentationHookFile\n          )\n          continue\n        }\n\n        if (fileName.endsWith('.ts') || fileName.endsWith('.tsx')) {\n          enabledTypeScript = true\n        }\n\n        if (!(isAppPath || isPagePath)) {\n          continue\n        }\n\n        // Collect all current filenames for the TS plugin to use\n        devPageFiles.add(fileName)\n\n        let pageName = absolutePathToPage(fileName, {\n          dir: isAppPath ? appDir! : pagesDir!,\n          extensions: nextConfig.pageExtensions,\n          keepIndex: isAppPath,\n          pagesType: isAppPath ? PAGE_TYPES.APP : PAGE_TYPES.PAGES,\n        })\n\n        if (\n          isAppPath &&\n          appDir &&\n          isMetadataRouteFile(\n            fileName.replace(appDir, ''),\n            nextConfig.pageExtensions,\n            true\n          )\n        ) {\n          const staticInfo = await getPageStaticInfo({\n            pageFilePath: fileName,\n            nextConfig: {},\n            page: pageName,\n            isDev: true,\n            pageType: PAGE_TYPES.APP,\n          })\n\n          pageName = normalizeMetadataPageToRoute(\n            pageName,\n            !!(staticInfo.generateSitemaps || staticInfo.generateImageMetadata)\n          )\n        }\n\n        if (\n          !isAppPath &&\n          pageName.startsWith('/api/') &&\n          nextConfig.output === 'export'\n        ) {\n          Log.error(\n            'API Routes cannot be used with \"output: export\". See more info here: https://nextjs.org/docs/advanced-features/static-html-export'\n          )\n          continue\n        }\n\n        if (isAppPath) {\n          const isRootNotFound = validFileMatcher.isRootNotFound(fileName)\n          hasRootAppNotFound = true\n\n          if (isRootNotFound) {\n            continue\n          }\n          if (!isRootNotFound && !validFileMatcher.isAppRouterPage(fileName)) {\n            continue\n          }\n          // Ignore files/directories starting with `_` in the app directory\n          if (normalizePathSep(pageName).includes('/_')) {\n            continue\n          }\n\n          const originalPageName = pageName\n          pageName = normalizeAppPath(pageName).replace(/%5F/g, '_')\n          if (!appPaths[pageName]) {\n            appPaths[pageName] = []\n          }\n          appPaths[pageName].push(originalPageName)\n\n          if (useFileSystemPublicRoutes) {\n            appFiles.add(pageName)\n          }\n\n          if (nextConfig.experimental.dynamicIO) {\n            const staticInfo = await getStaticInfoIncludingLayouts({\n              pageFilePath: fileName,\n              config: nextConfig,\n              appDir: appDir,\n              page: rootFile,\n              isDev: true,\n              isInsideAppDir: isAppPath,\n              pageExtensions: nextConfig.pageExtensions,\n            })\n\n            if (\n              'unsupportedSegmentConfigs' in staticInfo &&\n              staticInfo.unsupportedSegmentConfigs?.length\n            ) {\n              pagesWithUnsupportedSegments.set(\n                pageName,\n                staticInfo.unsupportedSegmentConfigs\n              )\n            }\n          }\n\n          if (routedPages.includes(pageName)) {\n            continue\n          }\n        } else {\n          if (useFileSystemPublicRoutes) {\n            pageFiles.add(pageName)\n            // always add to nextDataRoutes for now but in future only add\n            // entries that actually use getStaticProps/getServerSideProps\n            opts.fsChecker.nextDataRoutes.add(pageName)\n          }\n        }\n        ;(isAppPath ? appPageFilePaths : pagesPageFilePaths).set(\n          pageName,\n          fileName\n        )\n\n        if (appDir && pageNameSet.has(pageName)) {\n          conflictingAppPagePaths.add(pageName)\n        } else {\n          pageNameSet.add(pageName)\n        }\n\n        /**\n         * If there is a middleware that is not declared in the root we will\n         * warn without adding it so it doesn't make its way into the system.\n         */\n        if (/[\\\\\\\\/]_middleware$/.test(pageName)) {\n          nestedMiddleware.push(pageName)\n          continue\n        }\n\n        routedPages.push(pageName)\n      }\n\n      // When dynamicIO is enabled, certain segment configs are not supported as they conflict with dynamicIO behavior.\n      // This will print all the pages along with the segment configs that were used.\n      if (nextConfig.experimental.dynamicIO) {\n        const pagesWithIncompatibleSegmentConfigs: string[] = []\n\n        pagesWithUnsupportedSegments.forEach(\n          (unsupportedSegmentConfigs, page) => {\n            if (\n              unsupportedSegmentConfigs &&\n              unsupportedSegmentConfigs.length > 0\n            ) {\n              const configs = unsupportedSegmentConfigs.join(', ')\n              pagesWithIncompatibleSegmentConfigs.push(`${page}: ${configs}`)\n            }\n          }\n        )\n\n        if (pagesWithIncompatibleSegmentConfigs.length > 0) {\n          const errorMessage = `The following pages used segment configs which are not supported with \"experimental.dynamicIO\" and must be removed to build your application:\\n${pagesWithIncompatibleSegmentConfigs.join('\\n')}\\n`\n          Log.error(errorMessage)\n          hotReloader.setHmrServerError(new Error(errorMessage))\n          previouslyHadSegmentError = true\n        } else if (previouslyHadSegmentError) {\n          hotReloader.clearHmrServerError()\n          previouslyHadSegmentError = false\n        }\n      }\n\n      const numConflicting = conflictingAppPagePaths.size\n      conflictingPageChange = numConflicting - previousConflictingPagePaths.size\n\n      if (conflictingPageChange !== 0) {\n        if (numConflicting > 0) {\n          let errorMessage = `Conflicting app and page file${\n            numConflicting === 1 ? ' was' : 's were'\n          } found, please remove the conflicting files to continue:\\n`\n\n          for (const p of conflictingAppPagePaths) {\n            const appPath = path.relative(dir, appPageFilePaths.get(p)!)\n            const pagesPath = path.relative(dir, pagesPageFilePaths.get(p)!)\n            errorMessage += `  \"${pagesPath}\" - \"${appPath}\"\\n`\n          }\n          hotReloader.setHmrServerError(new Error(errorMessage))\n        } else if (numConflicting === 0) {\n          hotReloader.clearHmrServerError()\n          await propagateServerField(opts, 'reloadMatchers', undefined)\n        }\n      }\n\n      previousConflictingPagePaths = conflictingAppPagePaths\n\n      let clientRouterFilters: any\n      if (nextConfig.experimental.clientRouterFilter) {\n        clientRouterFilters = createClientRouterFilter(\n          Object.keys(appPaths),\n          nextConfig.experimental.clientRouterFilterRedirects\n            ? ((nextConfig as any)._originalRedirects || []).filter(\n                (r: any) => !r.internal\n              )\n            : [],\n          nextConfig.experimental.clientRouterFilterAllowedRate\n        )\n\n        if (\n          !previousClientRouterFilters ||\n          JSON.stringify(previousClientRouterFilters) !==\n            JSON.stringify(clientRouterFilters)\n        ) {\n          envChange = true\n          previousClientRouterFilters = clientRouterFilters\n        }\n      }\n\n      if (!usingTypeScript && enabledTypeScript) {\n        // we tolerate the error here as this is best effort\n        // and the manual install command will be shown\n        await verifyTypeScript(opts)\n          .then(() => {\n            tsconfigChange = true\n          })\n          .catch(() => {})\n      }\n\n      if (envChange || tsconfigChange) {\n        if (envChange) {\n          const { parsedEnv } = loadEnvConfig(\n            dir,\n            true,\n            Log,\n            true,\n            (envFilePath) => {\n              Log.info(`Reload env: ${envFilePath}`)\n            }\n          )\n\n          if (usingTypeScript && nextConfig.experimental?.typedEnv) {\n            // do not await, this is not essential for further process\n            createEnvDefinitions({\n              distDir,\n              env: { ...parsedEnv, ...nextConfig.env },\n            })\n          }\n\n          await propagateServerField(opts, 'loadEnvConfig', [\n            { dev: true, forceReload: true, silent: true },\n          ])\n        }\n        let tsconfigResult:\n          | UnwrapPromise<ReturnType<typeof loadJsConfig>>\n          | undefined\n\n        if (tsconfigChange) {\n          try {\n            tsconfigResult = await loadJsConfig(dir, nextConfig)\n          } catch (_) {\n            /* do we want to log if there are syntax errors in tsconfig while editing? */\n          }\n        }\n\n        if (hotReloader.turbopackProject) {\n          const hasRewrites =\n            opts.fsChecker.rewrites.afterFiles.length > 0 ||\n            opts.fsChecker.rewrites.beforeFiles.length > 0 ||\n            opts.fsChecker.rewrites.fallback.length > 0\n\n          await hotReloader.turbopackProject.update({\n            defineEnv: createDefineEnv({\n              isTurbopack: true,\n              clientRouterFilters,\n              config: nextConfig,\n              dev: true,\n              distDir,\n              fetchCacheKeyPrefix:\n                opts.nextConfig.experimental.fetchCacheKeyPrefix,\n              hasRewrites,\n              // TODO: Implement\n              middlewareMatchers: undefined,\n            }),\n          })\n        }\n\n        hotReloader.activeWebpackConfigs?.forEach((config, idx) => {\n          const isClient = idx === 0\n          const isNodeServer = idx === 1\n          const isEdgeServer = idx === 2\n          const hasRewrites =\n            opts.fsChecker.rewrites.afterFiles.length > 0 ||\n            opts.fsChecker.rewrites.beforeFiles.length > 0 ||\n            opts.fsChecker.rewrites.fallback.length > 0\n\n          if (tsconfigChange) {\n            config.resolve?.plugins?.forEach((plugin: any) => {\n              // look for the JsConfigPathsPlugin and update with\n              // the latest paths/baseUrl config\n              if (plugin instanceof JsConfigPathsPlugin && tsconfigResult) {\n                const { resolvedBaseUrl, jsConfig } = tsconfigResult\n                const currentResolvedBaseUrl = plugin.resolvedBaseUrl\n                const resolvedUrlIndex = config.resolve?.modules?.findIndex(\n                  (item) => item === currentResolvedBaseUrl?.baseUrl\n                )\n\n                if (resolvedBaseUrl) {\n                  if (\n                    resolvedBaseUrl.baseUrl !== currentResolvedBaseUrl?.baseUrl\n                  ) {\n                    // remove old baseUrl and add new one\n                    if (resolvedUrlIndex && resolvedUrlIndex > -1) {\n                      config.resolve?.modules?.splice(resolvedUrlIndex, 1)\n                    }\n\n                    // If the resolvedBaseUrl is implicit we only remove the previous value.\n                    // Only add the baseUrl if it's explicitly set in tsconfig/jsconfig\n                    if (!resolvedBaseUrl.isImplicit) {\n                      config.resolve?.modules?.push(resolvedBaseUrl.baseUrl)\n                    }\n                  }\n                }\n\n                if (jsConfig?.compilerOptions?.paths && resolvedBaseUrl) {\n                  Object.keys(plugin.paths).forEach((key) => {\n                    delete plugin.paths[key]\n                  })\n                  Object.assign(plugin.paths, jsConfig.compilerOptions.paths)\n                  plugin.resolvedBaseUrl = resolvedBaseUrl\n                }\n              }\n            })\n          }\n\n          if (envChange) {\n            config.plugins?.forEach((plugin: any) => {\n              // we look for the DefinePlugin definitions so we can\n              // update them on the active compilers\n              if (\n                plugin &&\n                typeof plugin.definitions === 'object' &&\n                plugin.definitions.__NEXT_DEFINE_ENV\n              ) {\n                const newDefine = getDefineEnv({\n                  isTurbopack: false,\n                  clientRouterFilters,\n                  config: nextConfig,\n                  dev: true,\n                  distDir,\n                  fetchCacheKeyPrefix:\n                    opts.nextConfig.experimental.fetchCacheKeyPrefix,\n                  hasRewrites,\n                  isClient,\n                  isEdgeServer,\n                  isNodeOrEdgeCompilation: isNodeServer || isEdgeServer,\n                  isNodeServer,\n                  middlewareMatchers: undefined,\n                })\n\n                Object.keys(plugin.definitions).forEach((key) => {\n                  if (!(key in newDefine)) {\n                    delete plugin.definitions[key]\n                  }\n                })\n                Object.assign(plugin.definitions, newDefine)\n              }\n            })\n          }\n        })\n        await hotReloader.invalidate({\n          reloadAfterInvalidation: envChange,\n        })\n      }\n\n      if (nestedMiddleware.length > 0) {\n        Log.error(\n          new NestedMiddlewareError(\n            nestedMiddleware,\n            dir,\n            (pagesDir || appDir)!\n          ).message\n        )\n        nestedMiddleware = []\n      }\n\n      // Make sure to sort parallel routes to make the result deterministic.\n      serverFields.appPathRoutes = Object.fromEntries(\n        Object.entries(appPaths).map(([k, v]) => [k, v.sort()])\n      )\n      await propagateServerField(\n        opts,\n        'appPathRoutes',\n        serverFields.appPathRoutes\n      )\n\n      // TODO: pass this to fsChecker/next-dev-server?\n      serverFields.middleware = middlewareMatchers\n        ? {\n            match: null as any,\n            page: '/',\n            matchers: middlewareMatchers,\n          }\n        : undefined\n\n      await propagateServerField(opts, 'middleware', serverFields.middleware)\n      serverFields.hasAppNotFound = hasRootAppNotFound\n\n      opts.fsChecker.middlewareMatcher = serverFields.middleware?.matchers\n        ? getMiddlewareRouteMatcher(serverFields.middleware?.matchers)\n        : undefined\n\n      const interceptionRoutes = generateInterceptionRoutesRewrites(\n        Object.keys(appPaths),\n        opts.nextConfig.basePath\n      ).map((item) =>\n        buildCustomRoute(\n          'before_files_rewrite',\n          item,\n          opts.nextConfig.basePath,\n          opts.nextConfig.experimental.caseSensitiveRoutes\n        )\n      )\n\n      opts.fsChecker.rewrites.beforeFiles.push(...interceptionRoutes)\n\n      const exportPathMap =\n        (typeof nextConfig.exportPathMap === 'function' &&\n          (await nextConfig.exportPathMap?.(\n            {},\n            {\n              dev: true,\n              dir: opts.dir,\n              outDir: null,\n              distDir: distDir,\n              buildId: 'development',\n            }\n          ))) ||\n        {}\n\n      const exportPathMapEntries = Object.entries(exportPathMap || {})\n\n      if (exportPathMapEntries.length > 0) {\n        opts.fsChecker.exportPathMapRoutes = exportPathMapEntries.map(\n          ([key, value]) =>\n            buildCustomRoute(\n              'before_files_rewrite',\n              {\n                source: key,\n                destination: `${value.page}${\n                  value.query ? '?' : ''\n                }${qs.stringify(value.query)}`,\n              },\n              opts.nextConfig.basePath,\n              opts.nextConfig.experimental.caseSensitiveRoutes\n            )\n        )\n      }\n\n      try {\n        // we serve a separate manifest with all pages for the client in\n        // dev mode so that we can match a page after a rewrite on the client\n        // before it has been built and is populated in the _buildManifest\n        const sortedRoutes = getSortedRoutes(routedPages)\n\n        opts.fsChecker.dynamicRoutes = sortedRoutes.map(\n          (page): FilesystemDynamicRoute => {\n            const regex = getRouteRegex(page)\n            return {\n              regex: regex.re.toString(),\n              match: getRouteMatcher(regex),\n              page,\n            }\n          }\n        )\n\n        const dataRoutes: typeof opts.fsChecker.dynamicRoutes = []\n\n        for (const page of sortedRoutes) {\n          const route = buildDataRoute(page, 'development')\n          const routeRegex = getRouteRegex(route.page)\n          dataRoutes.push({\n            ...route,\n            regex: routeRegex.re.toString(),\n            match: getRouteMatcher({\n              // TODO: fix this in the manifest itself, must also be fixed in\n              // upstream builder that relies on this\n              re: opts.nextConfig.i18n\n                ? new RegExp(\n                    route.dataRouteRegex.replace(\n                      `/development/`,\n                      `/development/(?<nextLocale>[^/]+?)/`\n                    )\n                  )\n                : new RegExp(route.dataRouteRegex),\n              groups: routeRegex.groups,\n            }),\n          })\n        }\n        opts.fsChecker.dynamicRoutes.unshift(...dataRoutes)\n\n        if (!prevSortedRoutes?.every((val, idx) => val === sortedRoutes[idx])) {\n          const addedRoutes = sortedRoutes.filter(\n            (route) => !prevSortedRoutes.includes(route)\n          )\n          const removedRoutes = prevSortedRoutes.filter(\n            (route) => !sortedRoutes.includes(route)\n          )\n\n          // emit the change so clients fetch the update\n          hotReloader.send({\n            action: HMR_ACTIONS_SENT_TO_BROWSER.DEV_PAGES_MANIFEST_UPDATE,\n            data: [\n              {\n                devPagesManifest: true,\n              },\n            ],\n          })\n\n          addedRoutes.forEach((route) => {\n            hotReloader.send({\n              action: HMR_ACTIONS_SENT_TO_BROWSER.ADDED_PAGE,\n              data: [route],\n            })\n          })\n\n          removedRoutes.forEach((route) => {\n            hotReloader.send({\n              action: HMR_ACTIONS_SENT_TO_BROWSER.REMOVED_PAGE,\n              data: [route],\n            })\n          })\n        }\n        prevSortedRoutes = sortedRoutes\n\n        if (!resolved) {\n          resolve()\n          resolved = true\n        }\n      } catch (e) {\n        if (!resolved) {\n          reject(e)\n          resolved = true\n        } else {\n          Log.warn('Failed to reload dynamic routes:', e)\n        }\n      } finally {\n        // Reload the matchers. The filesystem would have been written to,\n        // and the matchers need to re-scan it to update the router.\n        await propagateServerField(opts, 'reloadMatchers', undefined)\n      }\n    })\n\n    wp.watch({ directories: [dir], startTime: 0 })\n  })\n\n  const clientPagesManifestPath = `/_next/${CLIENT_STATIC_FILES_PATH}/development/${DEV_CLIENT_PAGES_MANIFEST}`\n  opts.fsChecker.devVirtualFsItems.add(clientPagesManifestPath)\n\n  const devMiddlewareManifestPath = `/_next/${CLIENT_STATIC_FILES_PATH}/development/${DEV_CLIENT_MIDDLEWARE_MANIFEST}`\n  opts.fsChecker.devVirtualFsItems.add(devMiddlewareManifestPath)\n\n  async function requestHandler(req: IncomingMessage, res: ServerResponse) {\n    const parsedUrl = url.parse(req.url || '/')\n\n    if (parsedUrl.pathname?.includes(clientPagesManifestPath)) {\n      res.statusCode = 200\n      res.setHeader('Content-Type', 'application/json; charset=utf-8')\n      res.end(\n        JSON.stringify({\n          pages: prevSortedRoutes.filter(\n            (route) => !opts.fsChecker.appFiles.has(route)\n          ),\n        })\n      )\n      return { finished: true }\n    }\n\n    if (parsedUrl.pathname?.includes(devMiddlewareManifestPath)) {\n      res.statusCode = 200\n      res.setHeader('Content-Type', 'application/json; charset=utf-8')\n      res.end(JSON.stringify(serverFields.middleware?.matchers || []))\n      return { finished: true }\n    }\n    return { finished: false }\n  }\n\n  async function logErrorWithOriginalStack(\n    err: unknown,\n    type?: 'unhandledRejection' | 'uncaughtException' | 'warning' | 'app-dir'\n  ) {\n    let usedOriginalStack = false\n\n    if (isError(err) && err.stack) {\n      try {\n        const frames = parseStack(err.stack!)\n        // Filter out internal edge related runtime stack\n        const frame = frames.find(\n          ({ file }) =>\n            !file?.startsWith('eval') &&\n            !file?.includes('web/adapter') &&\n            !file?.includes('web/globals') &&\n            !file?.includes('sandbox/context') &&\n            !file?.includes('<anonymous>')\n        )\n\n        let originalFrame: OriginalStackFrameResponse | null = null\n        let isEdgeCompiler = false\n        const frameFile = frame?.file\n        if (frame?.lineNumber && frameFile) {\n          if (hotReloader.turbopackProject) {\n            try {\n              originalFrame = await createOriginalTurboStackFrame(\n                hotReloader.turbopackProject,\n                {\n                  file: frameFile,\n                  methodName: frame.methodName,\n                  line: frame.lineNumber ?? 0,\n                  column: frame.column ?? undefined,\n                  isServer: true,\n                }\n              )\n            } catch {}\n          } else {\n            const moduleId = frameFile.replace(\n              /^(webpack-internal:\\/\\/\\/|file:\\/\\/)/,\n              ''\n            )\n            const modulePath = frameFile.replace(\n              /^(webpack-internal:\\/\\/\\/|file:\\/\\/)(\\(.*\\)\\/)?/,\n              ''\n            )\n\n            const src = getErrorSource(err as Error)\n            isEdgeCompiler = src === COMPILER_NAMES.edgeServer\n            const compilation = (\n              isEdgeCompiler\n                ? hotReloader.edgeServerStats?.compilation\n                : hotReloader.serverStats?.compilation\n            )!\n\n            const sourceMap = await (frame.file?.startsWith(path.sep) ||\n            frame.file?.startsWith('file:')\n              ? getSourceMapFromFile(frame.file)\n              : getSourceMapFromCompilation(moduleId, compilation))\n\n            if (sourceMap) {\n              try {\n                originalFrame = await createOriginalStackFrame({\n                  source: {\n                    type: 'bundle',\n                    sourceMap,\n                    compilation,\n                    moduleId,\n                    modulePath,\n                  },\n                  frame,\n                  rootDirectory: opts.dir,\n                  errorMessage: err.message,\n                })\n              } catch {}\n            }\n          }\n\n          if (\n            originalFrame?.originalCodeFrame &&\n            originalFrame.originalStackFrame\n          ) {\n            const { originalCodeFrame, originalStackFrame } = originalFrame\n            const { file, lineNumber, column, methodName } = originalStackFrame\n\n            Log[type === 'warning' ? 'warn' : 'error'](\n              `${file} (${lineNumber}:${column}) @ ${methodName}`\n            )\n\n            let errorToLog\n            if (isEdgeCompiler) {\n              errorToLog = err.message\n            } else if (isError(err) && hotReloader.turbopackProject) {\n              const stack = await traceTurbopackErrorStack(\n                hotReloader.turbopackProject,\n                err,\n                frames\n              )\n\n              const error: NextError = new Error(err.message)\n              error.stack = stack\n              error.digest = err.digest\n              errorToLog = error\n            } else {\n              errorToLog = err\n            }\n\n            logError(errorToLog, type)\n            console[type === 'warning' ? 'warn' : 'error'](originalCodeFrame)\n            usedOriginalStack = true\n          }\n        }\n      } catch (_) {\n        // failed to load original stack using source maps\n        // this un-actionable by users so we don't show the\n        // internal error and only show the provided stack\n      }\n    }\n\n    if (!usedOriginalStack) {\n      logError(err, type)\n    }\n  }\n\n  return {\n    serverFields,\n    hotReloader,\n    requestHandler,\n    logErrorWithOriginalStack,\n\n    async ensureMiddleware(requestUrl?: string) {\n      if (!serverFields.actualMiddlewareFile) return\n      return hotReloader.ensurePage({\n        page: serverFields.actualMiddlewareFile,\n        clientOnly: false,\n        definition: undefined,\n        url: requestUrl,\n      })\n    },\n  }\n}\n\nfunction logError(\n  err: unknown,\n  type?: 'unhandledRejection' | 'uncaughtException' | 'warning' | 'app-dir'\n) {\n  if (err instanceof ModuleBuildError) {\n    // Errors that may come from issues from the user's code\n    Log.error(err.message)\n  } else if (err instanceof TurbopackInternalError) {\n    // An internal Turbopack error that has been handled by next-swc, written\n    // to disk and a simplified message shown to user on the Rust side.\n  } else if (type === 'warning') {\n    Log.warn(err)\n  } else if (type === 'app-dir') {\n    logAppDirError(err)\n  } else if (type) {\n    Log.error(`${type}:`, err)\n  } else {\n    Log.error(err)\n  }\n}\n\nexport async function setupDevBundler(opts: SetupOpts) {\n  const isSrcDir = path\n    .relative(opts.dir, opts.pagesDir || opts.appDir || '')\n    .startsWith('src')\n\n  const result = await startWatcher(opts)\n\n  opts.telemetry.record(\n    eventCliSession(\n      path.join(opts.dir, opts.nextConfig.distDir),\n      opts.nextConfig,\n      {\n        webpackVersion: 5,\n        isSrcDir,\n        turboFlag: !!opts.turbo,\n        cliCommand: 'dev',\n        appDir: !!opts.appDir,\n        pagesDir: !!opts.pagesDir,\n        isCustomServer: !!opts.isCustomServer,\n        hasNowJson: !!(await findUp('now.json', { cwd: opts.dir })),\n      }\n    )\n  )\n  return result\n}\n\nexport type DevBundler = Awaited<ReturnType<typeof setupDevBundler>>\n\n// Returns a trace rewritten through Turbopack's sourcemaps\nasync function traceTurbopackErrorStack(\n  project: Project,\n  error: Error,\n  frames: StackFrame[]\n): Promise<string> {\n  let originalFrames = await Promise.all(\n    frames.map(async (f) => {\n      try {\n        const traced = await batchedTraceSource(project, {\n          file: f.file!,\n          methodName: f.methodName,\n          line: f.lineNumber ?? 0,\n          column: f.column ?? undefined,\n          isServer: true,\n        })\n\n        return traced?.frame ?? f\n      } catch {\n        return f\n      }\n    })\n  )\n\n  return (\n    error.name +\n    ': ' +\n    error.message +\n    '\\n' +\n    originalFrames\n      .map((f) => {\n        if (f == null) {\n          return null\n        }\n\n        let line = '    at'\n        if (f.methodName != null) {\n          line += ' ' + f.methodName\n        }\n\n        if (f.file != null) {\n          const file =\n            f.file.startsWith('/') ||\n            // Built-in \"filenames\" like `<anonymous>` shouldn't be made relative\n            f.file.startsWith('<') ||\n            f.file.startsWith('node:')\n              ? f.file\n              : `./${f.file}`\n\n          line += ` (${file}`\n          if (f.lineNumber != null) {\n            line += ':' + f.lineNumber\n\n            if (f.column != null) {\n              line += ':' + f.column\n            }\n          }\n          line += ')'\n        }\n\n        return line\n      })\n      .filter(Boolean)\n      .join('\\n')\n  )\n}\n"],"names":["getPageStaticInfo","createDefineEnv","fs","mkdir","url","path","qs","Watchpack","loadEnvConfig","isError","findUp","buildCustomRoute","Log","HotReloaderWebpack","setGlobal","loadJsConfig","createValidFileMatcher","eventCliSession","getDefineEnv","logAppDirError","getSortedRoutes","getStaticInfoIncludingLayouts","sortByPageExts","verifyTypeScriptSetup","verifyPartytownSetup","getRouteRegex","normalizeAppPath","buildDataRoute","getRouteMatcher","normalizePathSep","createClientRouterFilter","absolutePathToPage","generateInterceptionRoutesRewrites","CLIENT_STATIC_FILES_PATH","COMPILER_NAMES","DEV_CLIENT_PAGES_MANIFEST","DEV_CLIENT_MIDDLEWARE_MANIFEST","PHASE_DEVELOPMENT_SERVER","getMiddlewareRouteMatcher","isMiddlewareFile","NestedMiddlewareError","isInstrumentationHookFile","getPossibleMiddlewareFilenames","getPossibleInstrumentationHookFilenames","createOriginalStackFrame","getSourceMapFromCompilation","getSourceMapFromFile","parseStack","batchedTraceSource","createOriginalTurboStackFrame","devPageFiles","HMR_ACTIONS_SENT_TO_BROWSER","PAGE_TYPES","createHotReloaderTurbopack","getErrorSource","generateEncryptionKeyBase64","ModuleBuildError","TurbopackInternalError","isMetadataRouteFile","normalizeMetadataPageToRoute","createEnvDefinitions","JsConfigPathsPlugin","store","consoleStore","verifyTypeScript","opts","usingTypeScript","verifyResult","dir","distDir","nextConfig","intentDirs","pagesDir","appDir","filter","Boolean","typeCheckPreflight","tsconfigPath","typescript","disableStaticImages","images","hasAppDir","hasPagesDir","version","propagateServerField","field","args","renderServer","instance","startWatcher","resetFetch","useFileSystemPublicRoutes","join","distTypesDir","existsSync","recursive","validFileMatcher","pageExtensions","serverFields","setState","logging","hotReloader","turbo","config","buildId","encryptionKey","isBuild","telemetry","rewrites","fsChecker","previewProps","prerenderManifest","preview","start","experimental","nextScriptWorkers","ensureCallback","ensure","item","type","ensurePage","clientOnly","page","itemPath","isApp","definition","undefined","resolved","prevSortedRoutes","Promise","resolve","reject","readdir","_","files","length","pages","app","directories","rootDir","nestedMiddleware","envFiles","map","file","push","tsconfigPaths","wp","ignored","pathname","some","startsWith","d","fileWatchTimes","Map","enabledTypeScript","previousClientRouterFilters","previousConflictingPagePaths","Set","previouslyHadSegmentError","on","middlewareMatchers","routedPages","knownFiles","getTimeInfoEntries","appPaths","pageNameSet","conflictingAppPagePaths","appPageFilePaths","pagesPageFilePaths","pagesWithUnsupportedSegments","envChange","tsconfigChange","conflictingPageChange","hasRootAppNotFound","appFiles","pageFiles","clear","sortedKnownFiles","keys","sort","fileName","includes","meta","get","watchTime","watchTimeChange","timestamp","set","endsWith","accuracy","isPageFile","isAppPath","isPagePath","rootFile","extensions","keepIndex","pagesType","ROOT","staticInfo","pageFilePath","isDev","isInsideAppDir","output","error","actualMiddlewareFile","middleware","matchers","regexp","originalSource","actualInstrumentationHookFile","add","pageName","APP","PAGES","replace","pageType","generateSitemaps","generateImageMetadata","isRootNotFound","isAppRouterPage","originalPageName","dynamicIO","unsupportedSegmentConfigs","nextDataRoutes","has","test","pagesWithIncompatibleSegmentConfigs","forEach","configs","errorMessage","setHmrServerError","Error","clearHmrServerError","numConflicting","size","p","appPath","relative","pagesPath","clientRouterFilters","clientRouterFilter","Object","clientRouterFilterRedirects","_originalRedirects","r","internal","clientRouterFilterAllowedRate","JSON","stringify","then","catch","parsedEnv","envFilePath","info","typedEnv","env","dev","forceReload","silent","tsconfigResult","turbopackProject","hasRewrites","afterFiles","beforeFiles","fallback","update","defineEnv","isTurbopack","fetchCacheKeyPrefix","activeWebpackConfigs","idx","isClient","isNodeServer","isEdgeServer","plugins","plugin","jsConfig","resolvedBaseUrl","currentResolvedBaseUrl","resolvedUrlIndex","modules","findIndex","baseUrl","splice","isImplicit","compilerOptions","paths","key","assign","definitions","__NEXT_DEFINE_ENV","newDefine","isNodeOrEdgeCompilation","invalidate","reloadAfterInvalidation","message","appPathRoutes","fromEntries","entries","k","v","match","hasAppNotFound","middlewareMatcher","interceptionRoutes","basePath","caseSensitiveRoutes","exportPathMap","outDir","exportPathMapEntries","exportPathMapRoutes","value","source","destination","query","sortedRoutes","dynamicRoutes","regex","re","toString","dataRoutes","route","routeRegex","i18n","RegExp","dataRouteRegex","groups","unshift","every","val","addedRoutes","removedRoutes","send","action","DEV_PAGES_MANIFEST_UPDATE","data","devPagesManifest","ADDED_PAGE","REMOVED_PAGE","e","warn","watch","startTime","clientPagesManifestPath","devVirtualFsItems","devMiddlewareManifestPath","requestHandler","req","res","parsedUrl","parse","statusCode","setHeader","end","finished","logErrorWithOriginalStack","err","usedOriginalStack","stack","frames","frame","find","originalFrame","isEdgeCompiler","frameFile","lineNumber","methodName","line","column","isServer","moduleId","modulePath","src","edgeServer","compilation","edgeServerStats","serverStats","sourceMap","sep","rootDirectory","originalCodeFrame","originalStackFrame","errorToLog","traceTurbopackErrorStack","digest","logError","console","ensureMiddleware","requestUrl","setupDevBundler","isSrcDir","result","record","webpackVersion","turboFlag","cliCommand","isCustomServer","hasNowJson","cwd","project","originalFrames","all","f","traced","name"],"mappings":"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"}